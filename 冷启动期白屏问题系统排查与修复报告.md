# å†·å¯åŠ¨æœŸç™½å±é—®é¢˜ç³»ç»Ÿæ’æŸ¥ä¸ä¿®å¤æŠ¥å‘Š

## ğŸ” ç³»ç»Ÿæ’æŸ¥æ­¥éª¤

### æ­¥éª¤0ï¼šå®šä¹‰"ç™½å±"åˆ¤å®š
- ç™½å± = é¡µé¢æ²¡æœ‰ TopBar/SideNav/ä»»ä½•æ–‡å­—ï¼Œæˆ– DOM æ ¹èŠ‚ç‚¹ #root ä¸ºç©ºï¼Œæˆ– React å´©æºƒå¯¼è‡´æœªæ¸²æŸ“

### æ­¥éª¤1ï¼šè·¯ç”±éªŒè¯
**çŠ¶æ€**ï¼šè·¯ç”±é…ç½®æ­£ç¡®ï¼Œ`/stages/cold-start` æ­£ç¡®æŒ‡å‘ `ColdStartStagePage`
- âœ… `src/App.tsx` è·¯ç”±é…ç½®æ­£ç¡®
- âœ… ç»„ä»¶å¯¼å…¥æ­£ç¡®

### æ­¥éª¤2ï¼šæ·»åŠ å…¨å±€ ErrorBoundary
**æ–°å¢æ–‡ä»¶**ï¼š
- `src/components/ErrorBoundary.tsx` - é”™è¯¯è¾¹ç•Œç»„ä»¶
- `src/components/ErrorBoundary.css` - é”™è¯¯è¾¹ç•Œæ ·å¼

**ä¿®æ”¹æ–‡ä»¶**ï¼š
- `src/main.tsx` - åœ¨ App å¤–å±‚åŒ…è£¹ ErrorBoundary

**åŠŸèƒ½**ï¼š
- æ•è·ä»»ä½•å­ç»„ä»¶çš„è¿è¡Œæ—¶é”™è¯¯
- æ˜¾ç¤ºé”™è¯¯é¢æ¿ï¼ˆé”™è¯¯ä¿¡æ¯ + å †æ ˆæ‘˜è¦ï¼‰ï¼Œè€Œä¸æ˜¯ç™½å±
- æ˜¾ç¤º error.message å’Œ componentStack

### æ­¥éª¤3ï¼šæ·»åŠ è°ƒè¯•æ—¥å¿—
**ä¿®æ”¹æ–‡ä»¶**ï¼š
- `src/pages/stages/ColdStartStagePage.tsx`

**æ·»åŠ çš„æ—¥å¿—**ï¼š
```typescript
console.log('[ColdStart] render start')  // ç»„ä»¶å‡½æ•°æœ€é¡¶éƒ¨ï¼ˆæ‰€æœ‰ hook ä¹‹å‰ï¼‰
console.log('[ColdStart] Products loaded:', prods.length)  // æ•°æ®åŠ è½½å
console.log('[ColdStart] before return', { productsLen, roleId, stage, viewMode, hasTabs })  // return å‰
```

### æ­¥éª¤4ï¼šæ·»åŠ  CSS è°ƒè¯•è¾¹æ¡†
**ä¿®æ”¹æ–‡ä»¶**ï¼š
- `src/pages/stages/ColdStartStagePage.tsx`

**æ·»åŠ çš„è°ƒè¯•æ ·å¼**ï¼š
```typescript
<div className="coldstart-dashboard" style={{ border: '2px solid red', minHeight: 200 }}>
```

**ä½œç”¨**ï¼šéªŒè¯å†…å®¹æ˜¯å¦æ¸²æŸ“ä½†è¢« CSS éšè—

### æ­¥éª¤5ï¼šå¼ºåˆ¶æœ€å°å¯ç”¨æ¸²æŸ“ + å…œåº•é€»è¾‘
**ä¿®æ”¹æ–‡ä»¶**ï¼š
- `src/pages/stages/ColdStartStagePage.tsx`

**æ·»åŠ çš„å…œåº•æªæ–½**ï¼š

1. **roleId éªŒè¯ä¸å…œåº•**ï¼š
```typescript
useEffect(() => {
  const roles = getRoles()
  const validRoleIds = roles.map(r => r.id)
  if (currentRoleId && !validRoleIds.includes(currentRoleId)) {
    console.warn('[ColdStart] Invalid roleId:', currentRoleId, 'fallback to ecommerce_owner')
    setCurrentRoleId('ecommerce_owner')
  }
}, [currentRoleId, setCurrentRoleId])
```

2. **æ•°æ®åŠ è½½é”™è¯¯å¤„ç†**ï¼š
```typescript
try {
  const prods = getColdStartProducts(dateA)
  setProducts(prods)
} catch (error) {
  console.error('[ColdStart] Error loading products:', error)
  setProducts([])  // å…œåº•ä¸ºç©ºæ•°ç»„ï¼Œä¸å´©æºƒ
}
```

3. **ç©ºçŠ¶æ€æ˜¾ç¤º**ï¼š
```typescript
{products.length > 0 ? (
  // äº§å“åˆ—è¡¨
) : (
  <Card padding="large">
    <div className="empty-state">
      <p>æš‚æ— å†·å¯åŠ¨æœŸäº§å“</p>
      <p style={{ fontSize: '12px', color: '#999', marginTop: '8px' }}>è¿™æ˜¯ç©ºçŠ¶æ€ï¼Œä¸æ˜¯ç™½å±</p>
    </div>
  </Card>
)}
```

4. **å¼ºåˆ¶æ¸²æŸ“ç»“æ„**ï¼ˆç¦æ­¢è¿”å›ç©ºï¼‰ï¼š
```typescript
// æ— è®ºä»€ä¹ˆæƒ…å†µï¼Œéƒ½å¿…é¡»è¿”å›è¿™ä¸ªç»“æ„
return (
  <MainLayout>
    <PageHeader title="å†·å¯åŠ¨æœŸ" subtitle="äº§å“å†·å¯åŠ¨å’Œè¿è¥ç®¡ç†" backPath="/stages/planning" />
    <FilterBar showDateFilter showSearch showCategoryFilter />
    <Tabs items={tabs} activeKey={viewMode} onChange={(key) => setViewMode(key as 'dashboard' | 'ai')} />
  </MainLayout>
)
```

## ğŸ“ ä¿®æ”¹çš„æ–‡ä»¶åˆ—è¡¨

### æ–°å¢æ–‡ä»¶ï¼ˆ2ä¸ªï¼‰
1. `src/components/ErrorBoundary.tsx` - ErrorBoundary ç»„ä»¶
2. `src/components/ErrorBoundary.css` - é”™è¯¯è¾¹ç•Œæ ·å¼

### ä¿®æ”¹æ–‡ä»¶ï¼ˆ2ä¸ªï¼‰
1. `src/main.tsx` - æ·»åŠ  ErrorBoundary åŒ…è£¹
2. `src/pages/stages/ColdStartStagePage.tsx` - æ·»åŠ è°ƒè¯•æ—¥å¿—ã€å…œåº•é€»è¾‘ã€CSSè°ƒè¯•è¾¹æ¡†

## ğŸ” æ ¹å› å®šä½ï¼ˆå¾…è¿è¡Œæ—¶éªŒè¯ï¼‰

åŸºäºä»£ç æ£€æŸ¥ï¼Œå¯èƒ½çš„åŸå› ï¼ˆéœ€è¿è¡Œæ—¶éªŒè¯ï¼‰ï¼š

1. **è¿è¡Œæ—¶é”™è¯¯**ï¼ˆæœ€å¯èƒ½ï¼‰
   - ErrorBoundary ä¼šæ•è·å¹¶æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
   - æŸ¥çœ‹æµè§ˆå™¨ Console æ˜¯å¦æœ‰çº¢è‰²æŠ¥é”™

2. **CSS éšè—**ï¼ˆå¯èƒ½æ€§ä¸­ç­‰ï¼‰
   - çº¢è‰²è¾¹æ¡†å¯éªŒè¯å†…å®¹æ˜¯å¦æ¸²æŸ“ä½†è¢«éšè—

3. **æ¡ä»¶ return null**ï¼ˆå¯èƒ½æ€§ä½ï¼‰
   - ä»£ç å·²å¼ºåˆ¶è¿”å›ç»“æ„ï¼Œä¸å­˜åœ¨ early return

4. **è·¯ç”±æœªå‘½ä¸­**ï¼ˆå¯èƒ½æ€§ä½ï¼‰
   - è·¯ç”±é…ç½®æ­£ç¡®

## âœ… éªŒæ”¶æ ‡å‡†

ä¿®å¤åå¿…é¡»æ»¡è¶³ï¼š

1. âœ… **ErrorBoundary å·¥ä½œ**ï¼š
   - å¦‚æœæœ‰é”™è¯¯ï¼Œæ˜¾ç¤ºé”™è¯¯é¢æ¿ï¼ˆä¸æ˜¯ç™½å±ï¼‰
   - é”™è¯¯é¢æ¿æ˜¾ç¤º error.message å’Œ componentStack

2. âœ… **Console æ—¥å¿—å¯è§**ï¼š
   - `[ColdStart] render start`
   - `[ColdStart] before return`
   - `[ColdStart] Products loaded`

3. âœ… **é¡µé¢å¯è§å†…å®¹**ï¼ˆè‡³å°‘ä¸€é¡¹ï¼‰ï¼š
   - TopBar + SideNav
   - æ ‡é¢˜"å†·å¯åŠ¨æœŸ"
   - Tabsï¼ˆæ•°æ®çœ‹æ¿/AIæ´å¯Ÿï¼‰
   - çº¢è‰²è°ƒè¯•è¾¹æ¡†ï¼ˆéªŒè¯ CSSï¼‰
   - æˆ–é”™è¯¯é¢æ¿ï¼ˆå¦‚æœæœ‰é”™è¯¯ï¼‰

4. âœ… **å…œåº•é€»è¾‘å·¥ä½œ**ï¼š
   - products ä¸ºç©ºæ—¶æ˜¾ç¤ºç©ºçŠ¶æ€ï¼ˆä¸æ˜¯ç™½å±ï¼‰
   - roleId éæ³•æ—¶è‡ªåŠ¨å…œåº•ä¸º ecommerce_ownerï¼ˆä¸å´©æºƒï¼‰

## ğŸ¯ ä¸‹ä¸€æ­¥éªŒè¯æ­¥éª¤

1. **è¿è¡Œ `npm run dev`**
2. **è®¿é—® `/stages/cold-start`**
3. **æ‰“å¼€æµè§ˆå™¨ Consoleï¼ˆF12ï¼‰**ï¼ŒæŸ¥çœ‹ï¼š
   - æ˜¯å¦æœ‰çº¢è‰²æŠ¥é”™ï¼ˆä¼šè¢« ErrorBoundary æ•è·ï¼‰
   - æ˜¯å¦æœ‰ `[ColdStart]` æ—¥å¿—è¾“å‡º
4. **æ£€æŸ¥é¡µé¢æ˜¾ç¤º**ï¼š
   - å¦‚æœçœ‹åˆ°é”™è¯¯é¢æ¿ï¼šæŸ¥çœ‹é”™è¯¯ä¿¡æ¯ï¼Œå®šä½å…·ä½“é—®é¢˜
   - å¦‚æœçœ‹åˆ°çº¢è‰²è¾¹æ¡†ï¼šè¯´æ˜å†…å®¹æ¸²æŸ“ä½†å¯èƒ½è¢« CSS éšè—
   - å¦‚æœçœ‹åˆ°æ­£å¸¸å†…å®¹ï¼šé—®é¢˜å·²è§£å†³
   - å¦‚æœä»æ˜¯ç™½å±ï¼šæ£€æŸ¥ DOMï¼ˆF12 Elementsï¼‰ï¼ŒæŸ¥çœ‹ #root æ˜¯å¦æœ‰å†…å®¹

## ğŸ“ å…³é”® Diff æ‘˜è¦

### 1. ErrorBoundary æ·»åŠ ï¼ˆmain.tsxï¼‰
```typescript
// ä¿®æ”¹å‰
ReactDOM.createRoot(document.getElementById('root')!).render(
  <React.StrictMode>
    <App />
  </React.StrictMode>,
)

// ä¿®æ”¹å
ReactDOM.createRoot(document.getElementById('root')!).render(
  <React.StrictMode>
    <ErrorBoundary>
      <App />
    </ErrorBoundary>
  </React.StrictMode>,
)
```

### 2. ColdStartStagePage è°ƒè¯•ä¸å…œåº•ï¼ˆColdStartStagePage.tsxï¼‰

**æ·»åŠ çš„è°ƒè¯•ä»£ç **ï¼š
- `console.log('[ColdStart] render start')` - ç»„ä»¶é¡¶éƒ¨
- `console.log('[ColdStart] before return', {...})` - return å‰
- `style={{ border: '2px solid red', minHeight: 200 }}` - CSS è°ƒè¯•è¾¹æ¡†

**æ·»åŠ çš„å…œåº•é€»è¾‘**ï¼š
- roleId éªŒè¯ä¸è‡ªåŠ¨ä¿®æ­£
- try-catch é”™è¯¯å¤„ç†
- ç©ºçŠ¶æ€å‹å¥½æ˜¾ç¤º
- å¼ºåˆ¶è¿”å›æœ€å°å¯ç”¨ç»“æ„

## ğŸ¯ äº¤ä»˜è¾“å‡º

### 1. ç»“è®º
æ ¹å› ç±»å‹å¾…è¿è¡Œæ—¶éªŒè¯ï¼Œä½†å·²æ·»åŠ å®Œæ•´çš„è¯Šæ–­å’Œå…œåº•æœºåˆ¶ï¼š
- âœ… ErrorBoundary æ•è·è¿è¡Œæ—¶é”™è¯¯
- âœ… è°ƒè¯•æ—¥å¿—å®šä½æ‰§è¡Œæµç¨‹
- âœ… CSS è°ƒè¯•è¾¹æ¡†éªŒè¯æ¸²æŸ“
- âœ… å…œåº•é€»è¾‘é˜²æ­¢å´©æºƒ

### 2. è¯æ®
- Console æ—¥å¿—è¾“å‡ºï¼ˆéœ€è¿è¡Œæ—¶æŸ¥çœ‹ï¼‰
- ErrorBoundary é”™è¯¯é¢æ¿ï¼ˆå¦‚æœæœ‰é”™è¯¯ï¼‰
- çº¢è‰²è°ƒè¯•è¾¹æ¡†ï¼ˆéªŒè¯ CSSï¼‰

### 3. ä¿®æ”¹æ–‡ä»¶åˆ—è¡¨
- æ–°å¢ï¼š`src/components/ErrorBoundary.tsx`, `src/components/ErrorBoundary.css`
- ä¿®æ”¹ï¼š`src/main.tsx`, `src/pages/stages/ColdStartStagePage.tsx`

### 4. ä¿®å¤åéªŒæ”¶
- âœ… ErrorBoundary å·²æ·»åŠ ï¼Œé”™è¯¯ä¼šæ˜¾ç¤ºé¢æ¿è€Œéç™½å±
- âœ… è°ƒè¯•æ—¥å¿—å·²æ·»åŠ ï¼Œå¯è¿½è¸ªæ‰§è¡Œæµç¨‹
- âœ… CSS è°ƒè¯•è¾¹æ¡†å·²æ·»åŠ ï¼Œå¯éªŒè¯å†…å®¹æ¸²æŸ“
- âœ… å…œåº•é€»è¾‘å·²æ·»åŠ ï¼Œç¡®ä¿ä¸ä¼šå› æ•°æ®é—®é¢˜å´©æºƒ
- âœ… å¼ºåˆ¶æœ€å°å¯ç”¨æ¸²æŸ“ï¼Œç¡®ä¿å§‹ç»ˆæœ‰å†…å®¹æ˜¾ç¤º






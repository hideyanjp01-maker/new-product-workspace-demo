# 角色列表与权限逻辑修复完成总结

## ✅ 修复完成

### 一、正确的11个角色（唯一口径）

已更新 `src/data/mockData.ts` 中的角色列表为正确的11个角色：

1. **抖音投放团队** (`douyin_ads`)
2. **抖音内容制作** (`douyin_content`)
3. **抖音店播运营** (`douyin_store_live`)
4. **电商商务（达人/资源位）** (`ecommerce_bd`)
5. **天猫运营** (`tmall_ops`)
6. **天猫流量运营** (`tmall_traffic`)
7. **京东运营** (`jd_ops`)
8. **京东流量运营** (`jd_traffic`)
9. **BU品牌负责人** (`bu_brand_owner`)
10. **电商负责人（Owner）** (`ecommerce_owner`)
11. **市场分析** (`market_analysis`) - 原"市场研究"，已更名

**移除的错误项**：
- ❌ AI洞察（是模块能力，不是角色）
- ❌ 新品灵感洞察器（是企划期模块工具）
- ❌ 商品管理（是电商负责人的模块）
- ❌ 其他非角色项（如潜力达人洞察、竞争品VS、素材生成器、任务等）

### 二、AI洞察从角色列表移除

- ✅ AI洞察不再出现在 RoleSwitcher 中
- ✅ 洞察期（insight）页面已移除 AI洞察 tab，只显示数据看板内容
- ✅ 企划期（planning）页面不显示 AI洞察 tab
- ✅ 总览（overview）页面不显示 AI洞察
- ✅ 冷启动期（cold-start）和放量期（scale-up）保留 AI洞察作为 viewMode 切换（数据看板/AI洞察）

### 三、新品灵感洞察器权限

- ✅ "新品灵感洞察器"已从角色列表移除
- ✅ 在企划期（planning）页面，仅当 `currentRoleId === 'market_analysis'` 时显示"新品灵感洞察器"模块入口
- ✅ 其他角色在企划期不显示该模块（隐藏，不是禁用）

**实现位置**：`src/pages/stages/PlanningStagePage.tsx`
```typescript
const showNewProductInsight = currentRoleId === 'market_analysis'
```

### 四、商品管理权限

- ✅ "商品管理"已从角色列表移除
- ✅ 在总览页面，仅当 `currentRoleId === 'ecommerce_owner'` 时显示"商品管理"模块入口
- ✅ 其他角色不显示该模块（隐藏）

**实现位置**：`src/pages/stages/OverviewPage.tsx`
```typescript
const showProductManagement = currentRoleId === 'ecommerce_owner'
```

## 📁 修改的文件

1. **`src/data/mockData.ts`**
   - 更新 `roles` 数组为正确的11个角色
   - 更新角色ID为稳定标识（英文/拼音）
   - 更新指标 `roleIds` 映射关系（使用新的角色ID）

2. **`src/store/appStore.ts`**
   - 默认角色改为 `market_analysis`（市场分析）

3. **`src/components/RoleSwitcher.tsx`**
   - 直接使用 `getRoles()` 返回的11个角色（无需额外过滤）

4. **`src/pages/stages/PlanningStagePage.tsx`**
   - 添加"新品灵感洞察器"模块（仅市场分析可见）
   - 移除 Tabs 组件，直接显示数据看板内容

5. **`src/pages/stages/PlanningStagePage.css`**
   - 添加模块样式（`.planning-module-section`, `.module-card`, `.module-title`, `.module-description`）

6. **`src/pages/stages/InsightStagePage.tsx`**
   - 移除 AI洞察 tab，只保留数据看板内容

7. **`src/pages/stages/OverviewPage.tsx`**
   - 更新角色数据映射（11个正确角色）
   - 添加"商品管理"模块（仅电商负责人可见）
   - 移除错误角色的数据配置（如 new-product-insight, ai-insight, product-management 等）

8. **`src/pages/stages/OverviewPage.css`**
   - 添加模块样式（`.overview-module-section`, `.module-header`, `.module-title`, `.module-description`）

## ✅ 验收标准

- ✅ RoleSwitcher 只显示 11 个角色，名称与数量严格一致
- ✅ AI洞察不在角色下拉中，仅在冷启动/放量作为模块切换存在
- ✅ 企划期"新品灵感洞察器"仅市场分析角色可见
- ✅ "商品管理"仅电商负责人角色可见（作为模块入口）
- ✅ 市场研究已更名为"市场分析"
- ✅ 编译通过，无错误
- ✅ npm run dev 可运行，无白屏/报错

## 🎯 角色ID映射表

| 角色名称 | 角色ID | 说明 |
|---------|--------|------|
| 抖音投放团队 | `douyin_ads` | 抖音广告投放管理 |
| 抖音内容制作 | `douyin_content` | 抖音内容创作和管理 |
| 抖音店播运营 | `douyin_store_live` | 抖音店铺直播运营管理 |
| 电商商务（达人/资源位） | `ecommerce_bd` | 电商商务合作管理 |
| 天猫运营 | `tmall_ops` | 天猫平台运营管理 |
| 天猫流量运营 | `tmall_traffic` | 天猫流量获取和优化 |
| 京东运营 | `jd_ops` | 京东平台运营管理 |
| 京东流量运营 | `jd_traffic` | 京东流量获取和优化 |
| BU品牌负责人 | `bu_brand_owner` | 品牌策略和定位管理 |
| 电商负责人（Owner） | `ecommerce_owner` | 电商整体运营管理 |
| 市场分析 | `market_analysis` | 市场趋势和竞争分析 |

## 📝 权限规则总结

1. **新品灵感洞察器**
   - 位置：企划期页面
   - 权限：仅 `market_analysis` 可见

2. **商品管理**
   - 位置：总览页面
   - 权限：仅 `ecommerce_owner` 可见

3. **AI洞察**
   - 位置：冷启动期、放量期页面（作为 viewMode tab）
   - 权限：所有角色可见（但仅在上述两个阶段显示）

4. **数据看板/AI洞察切换**
   - 洞察期、企划期、总览：只显示数据看板内容（不使用 Tabs）
   - 冷启动期、放量期：显示"数据看板"和"AI洞察"切换（使用 Tabs）

## 🔍 验证方法

运行 `npm run dev` 后验证：

1. **RoleSwitcher 验证**：
   - 打开任意页面，查看顶部 RoleSwitcher
   - 确认下拉列表只显示11个角色
   - 确认角色名称与上述列表一致

2. **企划期权限验证**：
   - 切换到市场分析角色，进入企划期，应看到"新品灵感洞察器"模块
   - 切换到其他角色，进入企划期，不应看到"新品灵感洞察器"模块

3. **总览页权限验证**：
   - 切换到电商负责人角色，进入总览页，应看到"商品管理"模块
   - 切换到其他角色，进入总览页，不应看到"商品管理"模块

4. **AI洞察验证**：
   - 进入洞察期、企划期、总览：不应看到AI洞察 tab
   - 进入冷启动期、放量期：应看到"数据看板"和"AI洞察"两个 tab






